# one-language 项目启动指南

## 项目概述

这是一个沉浸式语言学习助手浏览器扩展，包含三个部分：
- **主扩展** (根目录) - 浏览器扩展本体
- **后端服务** (backend/) - SaaS 平台 API 服务
- **管理后台** (admin/) - 管理仪表板

## 环境要求

- Node.js 18+
- npm 或其他包管理器

---

## 一、浏览器扩展（主项目）

### 1. 安装依赖
```bash
npm install
```

### 2. 配置环境变量
```bash
copy .env.example .env
```
编辑 `.env` 文件，配置 API Key：
```env
VITE_WXT_DEFAULT_API_KEY="sk-rghnupwrjiiqoosmfccfkdhrgxsuybpvvlnlmdnxauhdqyvn"
VITE_WXT_DEFAULT_API_ENDPOINT="https://api.siliconflow.cn/v1/chat/completions"
VITE_WXT_DEFAULT_MODEL="Qwen/Qwen3-Next-80B-A3B-Instruct"
VITE_WXT_DEFAULT_TEMPERATURE="0.2"
```

### 3. 开发模式
```bash
# Chrome/Edge
npm run dev

# Firefox
npm run dev:firefox
```

### 4. 构建生产版本
```bash
# Chrome/Edge
npm run build
npm run zip

# Firefox
npm run build:firefox
npm run zip:firefox

# 所有平台
npm run zip:all
```

### 5. 加载扩展到浏览器

**Chrome/Edge:**
1. 打开 `chrome://extensions` 或 `edge://extensions`
2. 开启「开发者模式」
3. 点击「加载已解压的扩展程序」
4. 选择 `.output/chrome-mv3` 文件夹

**Firefox:**
1. 打开 `about:debugging#/runtime/this-firefox`
2. 点击「临时载入附加组件」
3. 选择 `.output/firefox-mv2/manifest.json`

---

## 二、后端服务

### 1. 进入目录并安装依赖
```bash
cd backend
npm install
```

### 2. 配置环境变量
```bash
copy .env.example .env
```

### 3. 数据库设置
```bash
# 生成 Prisma 客户端
npm run db:generate

# 运行数据库迁移
npm run db:migrate

# (可选) 填充种子数据
npm run db:seed
```

### 4. 启动服务
```bash
# 开发模式
npm run dev

# 生产模式
npm run build
npm run start
```

---

## 三、管理后台

### 1. 进入目录并安装依赖
```bash
cd admin
npm install
```

### 2. 配置环境变量
```bash
copy .env.example .env
```

### 3. 启动服务
```bash
# 开发模式
npm run dev

# 构建生产版本
npm run build

# 预览生产版本
npm run preview
```

---

## 常用命令速查

| 模块 | 命令 | 说明 |
|------|------|------|
| 扩展 | `npm run dev` | 开发模式 (Chrome) |
| 扩展 | `npm run build` | 构建生产版本 |
| 扩展 | `npm run zip` | 打包扩展 |
| 扩展 | `npm run lint:fix` | 修复代码风格 |
| 后端 | `npm run dev` | 开发模式 |
| 后端 | `npm run db:studio` | 打开数据库管理界面 |
| 管理 | `npm run dev` | 开发模式 |

---

## 注意事项

1. 扩展开发模式会自动热重载
2. 后端需要先配置数据库连接（MySQL）
3. `.env` 文件已在 `.gitignore` 中，不会被提交
4. Firefox 需要使用专门的构建命令
5. 后端 JWT_SECRET 至少需要 32 个字符
6. Admin 开发模式会自动代理 `/api` 到后端 `localhost:3000`

---

## 已配置的 .env 文件

### 根目录 `.env` (浏览器扩展)
- API 端点: `https://api.siliconflow.cn/v1/chat/completions`
- 模型: `Qwen/Qwen3-Next-80B-A3B-Instruct`
- API Key: 已配置

### backend/.env
- 数据库: MySQL (需要修改连接信息)
- 端口: 3000
- JWT 密钥: 已配置

### admin/.env
- API 地址: `/api` (通过 vite 代理到后端)
